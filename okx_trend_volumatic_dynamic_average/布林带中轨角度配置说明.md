# 布林带中轨角度指标 - 配置说明

## 📊 指标原理

布林带中轨角度指标通过**两层处理**来判断趋势：

```
原始收盘价 → [第一层] EMA平滑 → 中轨序列 → [第二层] 线性回归 → 角度/R²
```

### 第一层：EMA中轨平滑
- 将原始价格波动平滑成连续的中轨线
- 参数：`bb_midline_period`

### 第二层：线性回归角度分析
- 对中轨序列做线性拟合，计算倾斜角度和R²
- 参数：`bb_angle_window_size`

---

## 🎛️ 参数详解

### 1. bb_midline_period（EMA中轨周期）

**作用**：控制中轨对价格变化的敏感度

| 值范围 | 特性 | 适用场景 | 示例 |
|--------|------|----------|------|
| 10-15 | 快速响应，灵活 | 短期波动市场 | 震荡市、日内交易 |
| 20-30 | 平衡稳定（推荐） | 大多数情况 | 默认配置 |
| 40-50 | 平滑过滤，稳定 | 长期趋势跟踪 | 单边大趋势市场 |

**时间换算**（以30m周期为例）：
- 10根K线 = 5小时
- 20根K线 = 10小时
- 50根K线 = 25小时

---

### 2. bb_angle_window_size（角度计算窗口）

**作用**：控制角度看多长的趋势

| 值范围 | 特性 | 适用场景 | 示例 |
|--------|------|----------|------|
| 15-20 | 短期趋势 | 捕捉小波段 | 日内趋势 |
| 20-30 | 中期趋势（推荐） | 波段交易 | 1-2天趋势 |
| 40-50 | 长期趋势 | 大波段跟踪 | 3-5天趋势 |

**时间换算**（以30m周期为例）：
- 15根K线 = 7.5小时
- 20根K线 = 10小时
- 50根K线 = 25小时

---

### 3. bb_angle_threshold（角度阈值，单位：度）

**作用**：判断趋势是否足够明确

| 值 | 敏感度 | 开仓频率 | 风险 |
|----|--------|----------|------|
| 0.2° | 高 | 频繁 | 假信号多 |
| 0.3° | 中等（默认） | 适中 | 平衡 |
| 0.5° | 低 | 稀少 | 错过机会 |

**换算**：0.3° ≈ 每根K线涨跌0.52%

---

### 4. bb_r_squared_threshold（R²阈值，范围：0-1）

**作用**：过滤震荡市，只在明确趋势时开仓

| 值 | 过滤强度 | 开仓频率 | 适用场景 |
|----|----------|----------|----------|
| 0.5 | 宽松 | 较多 | 允许一定波动 |
| 0.6 | 中等（默认） | 适中 | 过滤大部分震荡 |
| 0.75 | 严格 | 稀少 | 只要单边趋势 |

**R²含义**：
- 0.9-1.0：完美单边趋势（数据点紧贴回归线）
- 0.6-0.8：明确趋势，有小波动
- 0.3-0.5：震荡市（数据点分散）

---

## 📋 配置示例

### 示例1：默认配置（适用大多数情况）
在 `strategy_configs.py` 中：
```python
'enable_bb_angle_entry': True,     # 启用独立开仓
'bb_midline_period': 20,           # 10小时中轨
'bb_angle_window_size': 20,        # 10小时趋势
'bb_angle_threshold': 0.3,         # 中等敏感度
'bb_r_squared_threshold': 0.6      # 中等过滤
```

**适用场景**：日常交易，平衡收益和风险

---

### 示例2：震荡市配置（快速响应）
```python
'enable_bb_angle_entry': True,
'bb_midline_period': 10,           # 5小时快速中轨
'bb_angle_window_size': 30,        # 15小时长期趋势判断
'bb_angle_threshold': 0.2,         # 敏感捕捉
'bb_r_squared_threshold': 0.5      # 宽松过滤
```

**适用场景**：
- 频繁小波动的市场
- 希望快速捕捉趋势启动
- 可承受更多交易次数

**优点**：反应快，捕捉小趋势
**缺点**：可能产生假信号

---

### 示例3：单边市配置（稳健跟随）
```python
'enable_bb_angle_entry': True,
'bb_midline_period': 30,           # 15小时平滑中轨
'bb_angle_window_size': 15,        # 7.5小时短期验证
'bb_angle_threshold': 0.5,         # 高要求
'bb_r_squared_threshold': 0.75     # 严格过滤
```

**适用场景**：
- 明确的单边大趋势
- 希望减少交易次数
- 只做高质量信号

**优点**：信号质量高，胜率高
**缺点**：可能错过早期入场点

---

### 示例4：激进配置（日内交易）
```python
# 需要同时修改策略主配置的timeframe
'timeframe': '15m',                # 更短周期
'enable_bb_angle_entry': True,
'bb_midline_period': 10,           # 2.5小时
'bb_angle_window_size': 15,        # 3.75小时
'bb_angle_threshold': 0.2,         # 敏感
'bb_r_squared_threshold': 0.5      # 宽松
```

**适用场景**：日内高频交易

---

### 示例5：保守配置（长期持仓）
```python
# 需要同时修改策略主配置的timeframe
'timeframe': '1h',                 # 更长周期
'enable_bb_angle_entry': True,
'bb_midline_period': 50,           # 50小时
'bb_angle_window_size': 40,        # 40小时
'bb_angle_threshold': 0.5,         # 严格
'bb_r_squared_threshold': 0.8      # 非常严格
```

**适用场景**：长期波段交易

---

## 🔧 参数调优建议

### 1. 两个周期参数的配合

| 中轨周期 | 角度窗口 | 组合特点 | 推荐场景 |
|----------|----------|----------|----------|
| 小 | 小 | 快速+短期 | 高频交易 |
| 小 | 大 | 快速+长期 | **震荡市推荐** ⭐ |
| 大 | 小 | 平滑+短期 | **单边市推荐** ⭐ |
| 大 | 大 | 平滑+长期 | 长期持仓 |

### 2. 调参流程

#### Step 1：选择基础配置
- 从默认配置（20, 20, 0.3, 0.6）开始

#### Step 2：根据市场特征调整
```
震荡市？
├─ 是 → 减小 bb_midline_period (10-15)
│        增大 bb_angle_window_size (30-40)
│
└─ 否（单边市）
        → 增大 bb_midline_period (30-40)
          减小 bb_angle_window_size (15-20)
```

#### Step 3：根据信号质量微调
```
假信号太多？
├─ 提高 bb_angle_threshold (0.4-0.5)
└─ 提高 bb_r_squared_threshold (0.7-0.8)

错过机会太多？
├─ 降低 bb_angle_threshold (0.2-0.25)
└─ 降低 bb_r_squared_threshold (0.5-0.55)
```

---

## 📈 开仓逻辑

### 开多条件
```
angle > bb_angle_threshold 
AND 
r² > bb_r_squared_threshold 
AND 
无持多仓
```

### 开空条件
```
angle < -bb_angle_threshold 
AND 
r² > bb_r_squared_threshold 
AND 
无持空仓
```

### 特点
- ✅ **独立信号**：不依赖VIDYA其他5个条件
- ✅ **满足即开**：不等待支撑/阻力位
- ✅ **最高优先级**：在所有开仓条件之前检查

---

## 💡 使用建议

1. **启用开关**
   - 在 `strategy_configs.py` 中设置 `enable_bb_angle_entry=True`
   - 观察信号质量，根据需要调整参数

2. **与VIDYA其他条件配合**
   - 可以同时启用多个开仓条件
   - 布林带角度优先级最高

3. **不同周期的建议值**

| 交易周期 | bb_midline_period | bb_angle_window_size | angle_threshold | r²_threshold |
|----------|-------------------|----------------------|-----------------|--------------|
| 5m | 10-20 | 15-25 | 0.2-0.3 | 0.5-0.6 |
| 15m | 15-25 | 20-30 | 0.25-0.35 | 0.55-0.65 |
| 30m | 20-30 | 20-40 | 0.3-0.4 | 0.6-0.7 |
| 1h | 30-40 | 30-50 | 0.35-0.5 | 0.65-0.75 |

4. **回测验证**
   - 每次调整参数后都要回测验证
   - 关注：胜率、收益率、交易次数、最大回撤

---

## 🎯 常见问题

### Q1: 两个周期参数应该设置成一样吗？
A: 不一定。根据市场特征灵活配置：
- 震荡市：中轨快（10）+ 窗口大（30）
- 单边市：中轨慢（30）+ 窗口小（15）
- 默认：统一配置（20, 20）

### Q2: 角度阈值设置多少合适？
A: 从0.3°开始，根据回测结果调整：
- 假信号多 → 提高到0.4-0.5°
- 错过机会 → 降低到0.2-0.25°

### Q3: R²阈值的意义？
A: R²过滤震荡市：
- 0.6：过滤大部分震荡（推荐）
- 0.75：只做高质量单边趋势
- 0.5：允许更多波动

### Q4: 如何判断参数配置是否合理？
A: 观察回测指标：
- 胜率 > 50%
- 收益/回撤比 > 2
- 交易次数：30m周期建议10-30次/月

---

## 📝 修改记录

- 2025-01-17: 初始版本，添加详细参数说明和配置示例

