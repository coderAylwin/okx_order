# SAR单周期策略交易逻辑说明

## 📋 策略概述

**策略名称**: SAR单周期趋势策略  
**交易币种**: ETH  
**时间周期**: 1小时  
**策略类型**: 趋势跟踪 + 反转交易  
**核心指标**: SAR (Parabolic SAR) + 布林带 + RSI + ATR + EMA  

---

## 🎯 核心交易逻辑

### 1. 开仓条件

#### 1.1 基础条件
- **指标预热完成**: SAR指标必须完成预热（200个数据点）
- **资金充足**: 现金余额 > 0
- **无持仓状态**: 当前无任何持仓

#### 1.2 SAR方向判断
- **多头信号**: `sar_direction == 1` (SAR上升趋势)
- **空头信号**: `sar_direction == -1` (SAR下降趋势)

#### 1.3 过滤条件

##### RSI过滤
- **多单条件**: `RSI ≤ 70`
- **空单条件**: `RSI ≥ 30`
- **RSI周期**: 14

##### ATR波动率过滤
- **ATR3**: 最近3个周期的平均真实波幅
- **ATR14**: 最近14个周期的平均真实波幅
- **过滤条件**: `ATR3/ATR14 ≤ 1.3`
- **目的**: 避免在波动率过高时开仓

#### 1.4 开仓触发时机
- **SAR方向改变**: 当SAR从上升转为下降，或从下降转为上升时
- **空仓直接开仓**: 当无持仓且SAR方向明确时

---

## 🚪 平仓条件

### 2.1 多单平仓条件

#### 固定止盈
- **触发条件**: `最高价 ≥ 止盈位`
- **止盈位计算**: `开仓价 × (1 + 固定止盈百分比/100)`
- **固定止盈百分比**: 1.5%
- **价格来源**: 1分钟K线最高价

#### 最大亏损
- **触发条件**: `最低价 ≤ 最大亏损位`
- **最大亏损位计算**: `开仓价 × (1 - 最大亏损百分比/100)`
- **最大亏损百分比**: 0% (已禁用)
- **价格来源**: 1分钟K线最低价

#### SAR动态止损
- **触发条件**: `最低价 ≤ SAR止损位`
- **止损位**: 当前SAR值（动态更新）
- **价格来源**: 1分钟K线最低价

### 2.2 空单平仓条件

#### 固定止盈
- **触发条件**: `最低价 ≤ 止盈位`
- **止盈位计算**: `开仓价 × (1 - 固定止盈百分比/100)`
- **固定止盈百分比**: 1.5%
- **价格来源**: 1分钟K线最低价

#### 最大亏损
- **触发条件**: `最高价 ≥ 最大亏损位`
- **最大亏损位计算**: `开仓价 × (1 + 最大亏损百分比/100)`
- **最大亏损百分比**: 0% (已禁用)
- **价格来源**: 1分钟K线最高价

#### SAR动态止损
- **触发条件**: `最高价 ≥ SAR止损位`
- **止损位**: 当前SAR值（动态更新）
- **价格来源**: 1分钟K线最高价

---

## 🔄 特殊平仓情况

### 3.1 SAR方向转换平仓
- **触发条件**: SAR方向发生改变
- **平仓价格**: K线开盘价
- **平仓后动作**: 立即反向开仓
- **手续费**: 0.02% (吃单手续费)

---

## 📊 技术指标参数

### 4.1 SAR参数
- **起始值**: 0.02
- **递增值**: 0.02
- **最大值**: 0.14
- **计算周期**: 1小时

### 4.2 布林带参数
- **中轨周期**: 14 (EMA)
- **标准差倍数**: 2.0
- **回归阻尼**: 0.9

### 4.3 RSI参数
- **周期**: 14
- **多单过滤**: ≤ 70
- **空单过滤**: ≥ 30

### 4.4 ATR参数
- **ATR3**: 最近3个周期平均
- **ATR14**: 最近14个周期平均
- **波动率阈值**: ≤ 1.3

### 4.5 EMA参数
- **EMA24**: 24周期指数移动平均
- **EMA50**: 50周期指数移动平均
- **EMA100**: 100周期指数移动平均
- **计算周期**: 1小时

---

## 💰 资金管理

### 5.1 仓位管理
- **仓位比例**: 100% (全仓交易)
- **资金计算**: 现金余额 × 仓位比例
- **手续费**: 开仓0.02%，平仓0.02%

### 5.2 资金更新
- **开仓时**: 现金余额 -= 实际投入金额
- **平仓时**: 现金余额 += 平仓总金额
- **平仓总金额**: 本金 + 盈亏 - 手续费

---

## ⚙️ 策略配置

### 6.1 基础配置
- **交易币种**: ETH
- **初始资金**: $100,000
- **回测期间**: 2025-01-01 至 2025-09-27

### 6.2 风险控制
- **固定止盈**: 1.5%
- **最大亏损**: 0% (禁用)
- **动态止损**: SAR线跟随
- **波动率过滤**: ATR比率 ≤ 1.3

---

## 🔍 交易信号优先级

### 7.1 开仓信号优先级
1. **SAR方向改变** (最高优先级)
2. **空仓直接开仓** (次优先级)
3. **过滤条件检查** (RSI、ATR等)

### 7.2 平仓信号优先级
1. **固定止盈** (最高优先级)
2. **最大亏损** (次优先级)
3. **SAR动态止损** (最低优先级)

---

## 📈 策略特点

### 8.1 优势
- **趋势跟踪**: 基于SAR指标捕捉趋势变化
- **风险控制**: 多重过滤条件降低风险
- **动态止损**: SAR线跟随，保护利润
- **全仓交易**: 最大化资金利用率

### 8.2 风险提示
- **单边市场**: 在震荡市场中可能频繁开平仓
- **全仓风险**: 100%仓位可能面临较大回撤
- **指标滞后**: SAR指标存在滞后性
- **手续费影响**: 频繁交易会增加手续费成本

---

## 📝 交易记录格式

### 9.1 开仓记录
- **信号类型**: OPEN_LONG / OPEN_SHORT
- **开仓价格**: K线收盘价
- **止损位**: 当前SAR值
- **止盈位**: 固定止盈位
- **投入金额**: 实际投入资金
- **交易份额**: 买入/卖出数量

### 9.2 平仓记录
- **信号类型**: TAKE_PROFIT_LONG / STOP_LOSS_LONG / TAKE_PROFIT_SHORT / STOP_LOSS_SHORT
- **平仓价格**: 触发价格
- **盈亏金额**: 实际盈亏
- **收益率**: 盈亏百分比
- **平仓原因**: 具体触发条件

---

*文档生成时间: 2025-01-28*  
*策略版本: v1.0*  
*适用币种: ETH*
